(()=>{"use strict";var e,t,a,n,o,r,c,i;!function(e){e[e.Gain=.5]="Gain",e[e.NumSamples=256]="NumSamples"}(e||(e={}));var l,u,s,h,f,d,v,g,y=function(e){a.src=e},m=function(e){e?(c.frequency.setValueAtTime(1e3,t.currentTime),c.gain.setValueAtTime(25,t.currentTime)):c.gain.setValueAtTime(0,t.currentTime)},S=function(e){e?(i.frequency.setValueAtTime(1e3,t.currentTime),i.gain.setValueAtTime(15,t.currentTime)):i.gain.setValueAtTime(0,t.currentTime)},p=function(e,t,a,n){return void 0===n&&(n=1),"rgba(".concat(e,",").concat(t,",").concat(a,",").concat(n,")")},w=function(){function e(e){var t=e.x,a=e.y,n=e.fillStyle,o=e.audioData,r=e.canvasWidth,c=e.rotation;Object.assign(this,{x:t,y:a,fillStyle:n,audioData:o,canvasWidth:r,rotation:c})}return e.prototype.update=function(){this.rotation+=.01},e.prototype.draw=function(e){for(var t,a=this.canvasWidth/2/this.audioData.length,n=0;n<this.audioData.length;n++)t=.5*this.audioData[n],e.save(),e.translate(this.x,this.y),e.rotate(n+2*Math.PI/this.audioData.length),e.fillStyle="yellow",e.fillRect(0,0,a,15),e.save(),e.rotate(this.rotation),e.fillStyle=this.fillStyle,e.fillRect(0,0,a,t),e.restore(),e.restore()},e}();const b=w;var q;!function(e){e.sound1="./media/New Adventure Theme.mp3"}(q||(q={}));var T,k,A=!1,D=!1,M="frequency",N={showCircles:!0,showNoise:!1,showInvert:!1,showEmboss:!1},E=function(){setTimeout(E,1e3/60),function(e,t){if("frequency"==t&&f.getByteFrequencyData(d),"wave"==t&&f.getByteTimeDomainData(d),l.save(),l.fillStyle=h,l.globalAlpha=.1,l.fillRect(0,0,u,s),l.restore(),e.showCircles){var a=s/2*1.5;l.save(),l.globalAlpha=.5;for(var n=0;n<d.length;n++){var o=d[n]/255,r=o*a;l.beginPath(),l.fillStyle=p(136,92,164,.34-o/3),l.arc(u/2,s,r,0,2*Math.PI,!1),l.fill(),l.closePath(),l.beginPath(),l.fillStyle=p(96,52,80,.1-o/10),l.arc(u/2,s,1.5*r,0,2*Math.PI,!1),l.fill(),l.closePath(),l.beginPath(),l.fillStyle=p(60,64,140,.5-o/5),l.arc(u/2,s,.5*r,0,2*Math.PI,!1),l.fill(),l.closePath()}l.restore()}l.save();var c=0;for(n=0;n<d.length;n++)g=d[n],l.save(),l.fillStyle="white",l.fillRect(u/2-c,s-g-15,v,10),l.restore(),l.save(),l.fillStyle="rgb(".concat(d[n],",").concat(d[n]-128,",").concat(255-d[n],")"),l.fillRect(u/2-c,s-g,v,g),l.restore(),c+=v,l.translate(-4,0);for(l.restore(),l.save(),n=0;n<d.length;n++)g=d[n],l.save(),l.fillStyle="white",l.fillRect(c,s-g-15,v,10),l.restore(),l.save(),l.fillStyle="rgb(".concat(d[n],",").concat(d[n]-128,",").concat(255-d[n],")"),l.fillRect(c,s-g,v,g),l.restore(),c+=v,l.translate(4,0);l.restore();var i=l.getImageData(0,0,u,s),y=i.data,m=y.length,S=i.width;for(n=0;n<m;n+=4)if(e.showNoise&&Math.random()<.05&&(y[n]=y[n+1]=y[n+2]=0,y[n+3]=200),e.showInvert){var w=y[n],b=y[n+1],q=y[n+2];y[n]=255-w,y[n+1]=255-b,y[n+2]=255-q}if(e.showEmboss)for(n=0;n<m;n++)n%4!=3&&(y[n]=127+2*y[n]-y[n+4]-y[n+4*S]);l.putImageData(i,0,0)}(N,M),k.forEach((function(e){e.update(),e.draw(l)}))},P=function(e){document.querySelector("#btn-fs").onclick=function(){var t;(t=e).requestFullscreen&&t.requestFullscreen()};var n=document.querySelector("#btn-play");n.onclick=function(e){var n=e.target;"suspended"==t.state&&t.resume(),"no"==n.dataset.playing?(a.play(),n.dataset.playing="yes"):(a.pause(),n.dataset.playing="no")};var o=document.querySelector("#slider-volume"),c=document.querySelector("#label-volume");o.oninput=function(e){var t,a=e.target;t=Number(a.value),r.gain.value=t,c.innerHTML=String(Math.round(Number(a.value)/2*100))},o.dispatchEvent(new Event("input")),document.querySelector("#select-track").onchange=function(e){var t=e.target;y(t.value),"yes"==n.dataset.playing&&n.dispatchEvent(new MouseEvent("click"))},document.querySelector("#cb-highshelf").onchange=function(e){var t=e.target;A=t.checked,m(A)},document.querySelector("#cb-lowshelf").onchange=function(e){var t=e.target;D=t.checked,S(D)},m(A),S(D),document.querySelector("#data-toggle").onchange=function(){for(var e=document.querySelectorAll(".audio-data"),t=0;t<e.length;t++){var a=e[t];a.checked&&(M=a.value)}},document.querySelector("#cb-circles").onclick=function(e){var t=e.target;N.showCircles=t.checked},document.querySelector("#cb-noise").onclick=function(e){var t=e.target;N.showNoise=t.checked},document.querySelector("#cb-invert").onclick=function(e){var t=e.target;N.showInvert=t.checked},document.querySelector("#cb-emboss").onclick=function(e){var t=e.target;N.showEmboss=t.checked}},I=function(){var e=new XMLHttpRequest;e.onload=function(){return x(e)},e.open("GET","./data/av-data.json"),e.send()},x=function(e){var t=e.responseText;try{T=JSON.parse(t)}catch(e){console.log("Bad JSON")}document.querySelector("title").innerHTML=T.title;for(var a="",n=0;n<T.tracks.length;n++)a+='<option value="'.concat(T.tracks[n].url,'">').concat(T.tracks[n].name,"</option>");for(document.querySelector("#select-track").innerHTML=a,n=0;n<T.data.length;n++)k.push(new b({x:T.data[n].x,y:T.data[n].y,fillStyle:T.data[n].color,audioData:d,canvasWidth:u,rotation:.05}))};window.onload=function(){!function(){var g,m;k=[],I(),g=q.sound1,m=window.AudioContext,t=new m,a=new Audio,y(g),n=t.createMediaElementSource(a),(c=t.createBiquadFilter()).type="highshelf",(i=t.createBiquadFilter()).type="lowshelf",(o=t.createAnalyser()).fftSize=e.NumSamples,(r=t.createGain()).gain.value=e.Gain,n.connect(c),c.connect(i),i.connect(o),o.connect(r),r.connect(t.destination);var S=document.querySelector("canvas");P(S),function(e,t){l=e.getContext("2d"),u=e.width,s=e.height,h=function(e,t,a,n,o,r){for(var c=e.createLinearGradient(0,0,0,o),i=0,l=[{percent:0,color:"rgba(14,14,14,1) "},{percent:1,color:"rgba(125,126,125,1)"}];i<l.length;i++){var u=l[i];c.addColorStop(u.percent,u.color)}return c}(l,0,0,0,s),f=t,d=new Uint8Array(f.fftSize/2),v=u/2/d.length}(S,o),E()}()}})();
//# sourceMappingURL=bundle.js.map